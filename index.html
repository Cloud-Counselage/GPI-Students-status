<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Intern Project Status Checker</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #fff7f1;
    margin: 0;
    padding: 20px;
    color: #222;
  }
  .header-logos {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  .header-logos img { width: 100px; height: auto; }
  .iac-logo { display:flex; justify-content:center; margin: 10px 0 0 0; }
  .iac-logo img { width: 120px; height: auto; }
  .title {
    text-align: center;
    font-size: 40px;
    font-weight: bold;
    margin: 10px 0 20px 0;
  }
  .container {
    max-width: 760px;
    margin: auto;
    background: #fff;
    padding: 24px;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0,0,0,0.08);
  }
  .instructions {
    text-align: left;
    background: #e9f5ff;
    padding: 12px;
    border-left: 5px solid #007acc;
    margin-bottom: 16px;
    border-radius: 6px;
  }
  #internId {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    margin-top: 6px;
    box-sizing: border-box;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  button.searchBtn {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    background-color: #EA7317;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 6px;
    font-size: 16px;
  }
  button.searchBtn:hover { background-color: #c85c07; }
  #result { margin-top: 18px; text-align: left; }
  .card {
    margin-bottom: 12px;
    padding: 12px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    background: #fbfbfb;
  }
  .no-result { color: #b00020; font-weight: 600; text-align:center; padding:10px; }
  .loading { color:#ff9800; text-align:center; padding:10px; }
  @media (max-width:600px) {
    .title { font-size: 28px; }
    .header-logos img { width: 80px; }
  }
</style>
</head>
<body>
  <div class="header-logos">
    <img src="ccpl_logo.png" alt="CCPL Logo">
    <img src="gac_foundation_logo.png" alt="GAC Foundation Logo">
  </div>
  <div class="iac-logo"><img src="iac_Logo.png" alt="IAC Logo"></div>
  <div class="title">Intern Project Status Checker</div>

  <div class="container">
    <div class="instructions">
      <h3>Instructions:</h3>
      <ul>
        <li><b>Record Not Found:</b> If your record isnâ€™t found after submission, please wait for some time.</li>
    <li><b>Recent Submissions:</b> If you submitted your project within the last month, it is still being processed. You will receive an email about your project status.</li>
    <li><b>Check Your Email:</b> If you donâ€™t see any email from <a href="mailto:member@industryacademiacommunity.com"><b>member@industryacademiacommunity.com</b></a>, please check your spam/junk folder. If itâ€™s still not found, email us and we will resend it.</li>
    <li><b>ðŸ”— Submission Link:</b> <a href="https://tinyurl.com/mwtwa7uw" target="_blank">https://tinyurl.com/mwtwa7uw</a></li>
      </ul>
    </div>

    <input id="internId" placeholder="Enter your Intern ID (e.g. IP23-000123 or IP -00001)" />
    <button class="searchBtn" id="searchBtn">Search</button>

    <div id="result"></div>
  </div>

<script>
const SHEET_ID = "1D7KyabOpUeTEDrP3rqTxWbBvEJmABI97"; 
const SHEET_NAME = "students";           

const resultDiv = document.getElementById('result');
const inputEl = document.getElementById('internId');
const searchBtn = document.getElementById('searchBtn');

let studentData = [];   
let headerKeys = [];    
let normalizedHeaderMap = {}; 

function showLoading(msg = "Loading data...") {
  resultDiv.innerHTML = `<div class="loading">${msg}</div>`;
}
function showError(msg) {
  resultDiv.innerHTML = `<div class="no-result">${msg}</div>`;
}
function clearResult() { resultDiv.innerHTML = ""; }

function normalizeId(str) {
  if (str === null || str === undefined) return "";
  return String(str).replace(/[\s\-]+/g, '').toUpperCase();
}
function normalizeKey(s) {
  if (!s) return "";
  return String(s).toLowerCase().replace(/[^a-z0-9]/g, '');
}
function buildVizUrl() {
  const base = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq`;
  const params = `?sheet=${encodeURIComponent(SHEET_NAME)}&tqx=out:json&cacheBust=${Date.now()}`;
  return base + params;
}
function parseGvizText(text) {
  const first = text.indexOf('{');
  const last = text.lastIndexOf('}');
  if (first === -1 || last === -1) throw new Error("Unexpected sheet response format");
  const jsonText = text.substring(first, last + 1);
  return JSON.parse(jsonText);
}
async function fetchSheetData() {
  try {
    showLoading("Loading data...");
    const url = buildVizUrl();
    const res = await fetch(url, { cache: "no-store" });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const text = await res.text();
    const parsed = parseGvizText(text);

    headerKeys = (parsed.table.cols || []).map((c, i) => {
      return (c && c.label) ? String(c.label).trim() : `Column${i+1}`;
    });

    normalizedHeaderMap = {};
    headerKeys.forEach(h => normalizedHeaderMap[normalizeKey(h)] = h);

    const rows = parsed.table.rows || [];
    studentData = rows.map(r => {
      const obj = {};
      for (let i = 0; i < headerKeys.length; i++) {
        const cell = (r.c && r.c[i]) ? r.c[i].v : "";
        obj[headerKeys[i]] = (cell === null || cell === undefined) ? "" : cell;
      }
      return obj;
    });

    if (!studentData.length) {
      showError("Sheet loaded but contains no rows.");
      return;
    }
    clearResult();
  } catch (err) {
    console.error("Error fetching/parsing sheet:", err);
    showError("Error loading student data.");
  }
}
function findHeader(friendly) {
  const target = normalizeKey(friendly);
  if (normalizedHeaderMap[target]) return normalizedHeaderMap[target];
  for (const key in normalizedHeaderMap) {
    if (key.includes(target) || target.includes(key)) return normalizedHeaderMap[key];
  }
  return null;
}
function formatDate(value) {
  if (!value) return "undefined";
  try {
    let dateObj;
    if (typeof value === "string" && value.startsWith("Date(")) {
      const parts = value.match(/\d+/g).map(Number);
      dateObj = new Date(parts[0], parts[1], parts[2]);
    } else if (typeof value === "number") {
      dateObj = new Date(Math.round((value - 25569) * 86400 * 1000));
    } else {
      dateObj = new Date(value);
    }
    if (isNaN(dateObj.getTime())) return "undefined";
    return dateObj.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
  } catch {
    return "undefined";
  }
}
function renderStudentCard(student) {
  const friendlyLabels = [
    "Intern ID",
    "Name",
    "College/ University Name",
    "Domain Name",
    "Verification Status",
    "Final Project Checking Result",
    "Final Excellence Award",
    "Final Comment",
    "Final Status"
  ];
  let html = '<div class="card">';
  friendlyLabels.forEach(label => {
    const header = findHeader(label);
    if (header && student[header] !== undefined && student[header] !== null && String(student[header]).trim() !== "") {
      html += `<div><b>${label}:</b> ${escapeHtml(student[header])}</div>`;
    }
  });

  // Always show Experience Letter Sent Date
  const expHeader = findHeader("Experience Letter Sent Date");
  let expValue = "undefined";
  if (expHeader && student[expHeader] !== undefined && student[expHeader] !== null && String(student[expHeader]).trim() !== "") {
    expValue = formatDate(student[expHeader]);
  }
  html += `<div><b>Experience Letter Sent Date:</b> ${escapeHtml(expValue)}</div>`;

  html += '</div>';
  return html;
}
function escapeHtml(str) {
  return String(str)
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'",'&#039;');
}
function doSearch() {
  const raw = inputEl.value.trim();
  const q = normalizeId(raw);
  if (!q) {
    resultDiv.innerHTML = '<div class="no-result">Please enter an Intern ID.</div>';
    return;
  }
  if (!studentData.length) {
    resultDiv.innerHTML = '<div class="loading">Data not yet loaded.</div>';
    return;
  }
  let internHeader = findHeader("Intern ID") || headerKeys[0];
  const matches = studentData.filter(row => normalizeId(row[internHeader]) === q);
  if (!matches.length) {
    resultDiv.innerHTML = `<div class="no-result">Intern ID not found.</div>`;
    return;
  }
  const out = matches.map(renderStudentCard).join('');
  resultDiv.innerHTML = out;
}
searchBtn.addEventListener('click', () => doSearch());
inputEl.addEventListener('keydown', (e) => { if (e.key === 'Enter') doSearch(); });
fetchSheetData();
</script>
</body>
</html>
